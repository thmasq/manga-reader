{% extends "admin/base.html" %}

{% block title %}Pages - Chapter {{ chapter.chapter_num }} ({{ chapter.language_name_en }}) - {{ chapter.name_english or chapter.name_romanized or chapter.name_original or 'Unknown' }} - Manga Admin{% endblock %}

{% block content %}
<div class="page-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="page-title">Chapter {{ chapter.chapter_num }} Pages</h1>
            <p class="page-subtitle">{{ chapter.name_english or chapter.name_romanized or chapter.name_original or 'Unknown' }} - {{ chapter.language_name_en }}</p>
        </div>
        <div class="flex gap-2">
            <a href="{{ url_for('page_new', chapter_id=chapter.chapter_id, language_id=language_id) }}" class="btn btn-primary">Add New Page</a>
            <a href="{{ url_for('chapter_translations', chapter_id=chapter.chapter_id) }}" class="btn btn-secondary">Back to Translations</a>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="flex justify-between items-center">
            <h2 class="card-title">Page List</h2>
            <span class="relationship-tag">{{ pages|length }} pages</span>
        </div>
    </div>
    <div class="card-body">
        {% if pages %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                {% for page in pages %}
                <div class="card" style="margin: 0;">
                    <div class="card-body text-center">
                        <div style="aspect-ratio: 3/4; background-color: var(--gray-100); border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem;">
                            {% if page.page_path %}
                                <img src="{{ url_for('serve_image', image_path=page.page_path) }}" 
                                     alt="Page {{ page.page_num }}"
                                     style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 0.375rem;"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; color: var(--gray-500); font-size: 0.875rem;">
                                    No Preview
                                </div>
                            {% else %}
                                <div style="color: var(--gray-500); font-size: 0.875rem;">
                                    No Image
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            <strong>Page {{ page.page_num }}</strong>
                            {% if page.page_path %}
                                <br><small style="color: var(--gray-500); word-break: break-all;">{{ page.page_path }}</small>
                            {% endif %}
                        </div>
                        <div class="flex gap-1 mt-2" style="justify-content: center;">
                            <a href="{{ url_for('page_edit', page_id=page.page_id) }}" class="btn btn-small btn-primary">Edit</a>
                            <form method="POST" action="{{ url_for('page_delete', page_id=page.page_id) }}" style="display: inline;" 
                                  onsubmit="return confirm('Are you sure you want to delete this page?')">
                                <button type="submit" class="btn btn-small btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-center">No pages found. <a href="{{ url_for('page_new', chapter_id=chapter.chapter_id, language_id=language_id) }}">Add the first page</a>!</p>
        {% endif %}
    </div>
</div>
{% endblock %}

